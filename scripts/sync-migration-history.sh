#!/bin/bash
# Sync remote migration history to match local migrations.
# Run from project root: ./scripts/sync-migration-history.sh

set -e
cd "$(dirname "$0")/.."

# Remote-only versions (on remote but not in local files) - REVERT these
REMOTE_ONLY="20260118002404 20260118002412 20260118003104 20260118003832 20260118003837 20260118003845 20260118003849 20260118004759 20260118004938 20260118005354 20260118015417 20260118020633 20260118020635 20260118021514 20260118022431 20260118022828 20260118022832 20260118025216 20260118032741 20260118032840 20260118033932 20260118064644 20260118065224 20260118065939 20260118071500 20260118072058 20260118072333 20260118072605 20260118073046 20260118074815 20260118075050 20260206224938 20260206225000 20260207203912 20260207210555 20260207212507 20260207213408 20260208184519 20260208185408 20260208185951 20260210164502 20260210164514 20260210164527 20260210164549 20260210164601 20260210181155 20260210181203 20260210181253 20260210181315 20260210181348 20260210182847 20260210182855 20260210182900 20260210192340 20260210203518 20260210213741 20260210234559 20260211001850 20260211154734 20260211154754 20260211154823 20260211154837 20260211194857 20260211234939 20260212005158 20260212165259 20260213045706 20260213045715 20260213211028 20260217052952 20260217054130 20260217054535 20260217145201 20260217153130 20260217153258 20260217162937 20260217185627 20260217195436 20260217200029 20260217202016 20260218194350 20260218194433 20260218214642"

# Local-only versions (in local files but not on remote) - MARK APPLIED
LOCAL_ONLY="20260207143847 20260207150542 20260207152456 20260207153354 20260207203809 20260208124509 20260208125355 20260208125941 20260210120013 20260210120029 20260210120043 20260210120110 20260210120142 20260210122816 20260210122817 20260210122818 20260210174420 20260210181820 20260210193624 20260211000001 20260211000002 20260211200000 20260211210000 20260212170000 20260212180000 20260212190000 20260212200000 20260212210000 20260212220000 20260212230000 20260212240000 20260212250000 20260212260000 20260213000000 20260213000001 20260213000002 20260213000003 20260213000004 20260213000005 20260213000006 20260213000007 20260217050000 20260217060000 20260217070000 20260217100000 20260217150000 20260217160000 20260217170000 20260217180000 20260217190000 20260217200000 20260217210000 20260217230000 20260218000003 20260218100000"

echo "Step 1: Reverting remote-only migrations (removes from remote history)..."
supabase migration repair --status reverted $REMOTE_ONLY

echo ""
echo "Step 2: Marking local-only migrations as applied (adds to remote history)..."
supabase migration repair --status applied $LOCAL_ONLY

echo ""
echo "Done. Run 'supabase migration list' to verify."
